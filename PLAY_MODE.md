# 播放模式实现说明

## 功能概述

播放模式已完整实现，包含以下特性：

### A. 播放模式 (Action: play)

#### 1. 触发逻辑
- **NFC 触发**：触碰"播放标签"（`heartecho://action/play`）
- **重放机制**：正在播放时再次触碰，立即从头重放
- **缓存策略**：优先从 Room 数据库查找并播放本地缓存音频

#### 2. UI 表现
- **全屏高对比度进度条**
  - 黑色背景 (#1E1E1E)
  - 绿色进度条 (#4CAF50)
  - 白色文字显示百分比
  - 平滑动画效果

- **播放控制**
  - 播放/暂停图标 (▶/⏸)
  - 时间显示（当前时间 / 总时长）
  - 红色停止按钮

#### 3. 引导语音
- **自动播放**：`res/raw/play_start.mp3`
- **内容**：「奶奶，正在为您播报最新的留言」
- **流程**：引导语音播放完成后 → 自动播放录音

## 添加引导语音文件

### 步骤：
1. 录制或生成语音文件：「奶奶，正在为您播报最新的留言」
2. 转换为 MP3 格式
3. 将文件命名为 `play_start.mp3`（必须小写）
4. 放置在 `app/src/main/res/raw/` 目录下
5. 重新构建项目

### 注意事项：
- 文件名必须全部小写，只能包含 a-z、0-9 和下划线
- 如果没有此文件，应用会跳过引导语音直接播放录音
- 建议时长：3-5 秒

## 数据库结构

### AudioRecord 实体
```kotlin
- id: Long (主键)
- filePath: String (音频文件路径)
- duration: Int (时长，秒)
- createdAt: Long (创建时间戳)
- nfcTagId: String? (关联的 NFC 标签 ID)
- isPlayed: Boolean (是否已播放)
```

## NFC 动作

### 播放最新录音
```
heartecho://action/play
```

### 播放指定 ID 的录音
```
heartecho://action/play/{audioId}
```

### 开始录音
```
heartecho://action/record
```

## 已实现的功能

✅ Room 数据库（实体、DAO、Database）
✅ AudioPlayerService（ExoPlayer 播放服务）
✅ 引导语音播放
✅ 高对比度进度条 UI
✅ 播放状态管理
✅ 从头重放机制
✅ 本地缓存查询
✅ 已播放标记

## 测试流程

1. **录制音频**：点击"开始录音" → 录制 → 确认发送
2. **保存到数据库**：音频自动保存到 Room 数据库
3. **NFC 触发播放**：
   - 创建 NFC 标签，写入 `heartecho://action/play`
   - 触碰标签触发播放
4. **验证功能**：
   - 引导语音播放
   - 进度条显示
   - 时间更新
   - 重放功能
